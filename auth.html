<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - Earnly</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --secondary: #10b981;
  --accent: #f59e0b;
  --danger: #ef4444;
  --dark-1: #111827;
  --dark-2: #1f2937;
  --dark-3: #374151;
  --text-primary: #f3f4f6;
  --text-secondary: #d1d5db;
  --border-radius: 12px;
  --transition: all 0.3s ease;
  --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}

body {
  background: linear-gradient(135deg, var(--dark-1) 0%, var(--dark-2) 100%);
  color: var(--text-primary);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
}

.auth-container {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid var(--dark-3);
  border-radius: var(--border-radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 400px;
}

.auth-header {
  text-align: center;
  margin-bottom: 2rem;
}

.logo {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 0.5rem;
}

.auth-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.auth-subtitle {
  color: var(--text-secondary);
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--text-secondary);
}

.form-control {
  width: 100%;
  padding: 0.75rem 1rem;
  background: var(--dark-3);
  border: 1px solid var(--dark-3);
  border-radius: var(--border-radius);
  color: var(--text-primary);
  font-size: 1rem;
  transition: var(--transition);
}

.form-control:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
}

.btn {
  width: 100%;
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: var(--border-radius);
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  font-size: 1rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  box-shadow: var(--shadow);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 25px -5px rgba(99, 102, 241, 0.4);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.auth-switch {
  text-align: center;
  margin-top: 1.5rem;
  color: var(--text-secondary);
}

.auth-switch a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
}

.auth-switch a:hover {
  text-decoration: underline;
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background: var(--dark-2);
  padding: 2rem;
  border-radius: var(--border-radius);
  width: 90%;
  max-width: 400px;
  text-align: center;
}

.back-btn {
  position: absolute;
  top: 2rem;
  left: 2rem;
  background: var(--dark-3);
  color: var(--text-primary);
  border: none;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.2rem;
  transition: var(--transition);
}

.back-btn:hover {
  background: var(--primary);
}

.password-input {
  position: relative;
}

.password-toggle {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 1rem;
  transition: var(--transition);
}

.password-toggle:hover {
  color: var(--primary);
}

@media (max-width: 480px) {
  .auth-container {
    padding: 1.5rem;
  }
}
</style>
</head>
<body>

<button class="back-btn" onclick="window.location.href='index.html'">
  <i class="fas fa-arrow-left"></i>
</button>

<div class="auth-container">
  <div class="auth-header">
    <div class="logo">
      <i class="fas fa-coins"></i> Earnly
    </div>
    <h1 class="auth-title" id="authTitle">Welcome Back</h1>
    <p class="auth-subtitle" id="authSubtitle">Sign in to your account</p>
  </div>

  <form id="authForm" onsubmit="handleAuth(event)">
    <div class="form-group" id="usernameGroup" style="display: none;">
      <label for="username">Full Name *</label>
      <input type="text" id="username" class="form-control" placeholder="Enter your full name" required>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" class="form-control" placeholder="Enter email" required>
    </div>

    <div class="form-group" id="phoneGroup" style="display: none;">
      <label for="phone">Phone Number *</label>
      <input type="tel" id="phone" class="form-control" placeholder="Enter phone number" oninput="detectNetwork()" required>
    </div>

    <div class="form-group" id="countryGroup" style="display: none;">
      <label for="country">Country *</label>
      <select id="country" class="form-control" onchange="loadStates()" required>
        <option value="">Select Country</option>
      </select>
    </div>

    <div class="form-group" id="stateGroup" style="display: none;">
      <label for="state">State/Province *</label>
      <select id="state" class="form-control" required>
        <option value="">Select State/Province</option>
      </select>
    </div>

    <div class="form-group" id="genderGroup" style="display: none;">
      <label for="gender">Gender *</label>
      <select id="gender" class="form-control" required>
        <option value="">Select Gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="custom">Custom</option>
      </select>
    </div>

    <div class="form-group" id="verificationGroup" style="display: none;">
      <label for="verification">Receive verification code via: *</label>
      <select id="verification" class="form-control" required>
        <option value="phone">Phone Number</option>
        <option value="email">Email</option>
      </select>
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <div class="password-input">
        <input type="password" id="password" class="form-control" placeholder="Enter password" required>
        <button type="button" class="password-toggle" onclick="togglePassword('password')">
          <i class="fas fa-eye" id="passwordEye"></i>
        </button>
      </div>
    </div>

    <div class="form-group" id="confirmPasswordGroup" style="display: none;">
      <label for="confirmPassword">Confirm Password *</label>
      <div class="password-input">
        <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm password" required>
        <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
          <i class="fas fa-eye" id="confirmPasswordEye"></i>
        </button>
      </div>
    </div>

    <button type="submit" class="btn btn-primary" id="authBtn">
      <i class="fas fa-sign-in-alt"></i> Sign In
    </button>

    <div id="verificationModal" class="modal" style="display: none;">
      <div class="modal-content">
        <h3>Enter Verification Code</h3>
        <p>We've sent a 4-digit code to your selected method</p>
        <input type="text" id="verificationCode" maxlength="4" style="width: 100%; padding: 1rem; font-size: 1.5rem; text-align: center; letter-spacing: 0.5rem; margin: 1rem 0;">
        <div style="display: flex; gap: 1rem;">
          <button type="button" onclick="closeVerificationModal()" style="width: 48%; padding: 0.75rem; background: var(--dark-3); color: var(--text-primary); border: none; border-radius: var(--border-radius); cursor: pointer;">Cancel</button>
          <button type="button" onclick="verifyCode()" class="btn btn-primary" style="width: 48%;">Confirm Sign Up</button>
        </div>
      </div>
    </div>
  </form>

  <div class="auth-switch">
    <span id="switchText">Don't have an account?</span>
    <a href="#" onclick="toggleAuthMode()" id="switchLink">Sign up</a>
  </div>
</div>

<script src="js/api.js"></script>
<script>
let isLoginMode = true;

const countries = {
  'Afghanistan': ['Badakhshan', 'Badghis', 'Baghlan', 'Balkh', 'Bamyan', 'Daykundi', 'Farah', 'Faryab', 'Ghazni', 'Ghor', 'Helmand', 'Herat', 'Jowzjan', 'Kabul', 'Kandahar', 'Kapisa', 'Khost', 'Kunar', 'Kunduz', 'Laghman', 'Logar', 'Nangarhar', 'Nimroz', 'Nuristan', 'Paktia', 'Paktika', 'Panjshir', 'Parwan', 'Samangan', 'Sar-e Pol', 'Takhar', 'Urozgan', 'Wardak', 'Zabul'],
  'Albania': ['Berat', 'Dibër', 'Durrës', 'Elbasan', 'Fier', 'Gjirokastër', 'Korçë', 'Kukës', 'Lezhë', 'Shkodër', 'Tirana', 'Vlorë'],
  'Algeria': ['Adrar', 'Chlef', 'Laghouat', 'Oum El Bouaghi', 'Batna', 'Béjaïa', 'Biskra', 'Béchar', 'Blida', 'Bouira', 'Tamanrasset', 'Tébessa', 'Tlemcen', 'Tiaret', 'Tizi Ouzou', 'Algiers', 'Djelfa', 'Jijel', 'Sétif', 'Saïda', 'Skikda', 'Sidi Bel Abbès', 'Annaba', 'Guelma', 'Constantine', 'Médéa', 'Mostaganem', 'MSila', 'Mascara', 'Ouargla', 'Oran', 'El Bayadh', 'Illizi', 'Bordj Bou Arréridj', 'Boumerdès', 'El Tarf', 'Tindouf', 'Tissemsilt', 'El Oued', 'Khenchela', 'Souk Ahras', 'Tipaza', 'Mila', 'Aïn Defla', 'Naâma', 'Aïn Témouchent', 'Ghardaïa', 'Relizane'],
  'Argentina': ['Buenos Aires', 'Catamarca', 'Chaco', 'Chubut', 'Córdoba', 'Corrientes', 'Entre Ríos', 'Formosa', 'Jujuy', 'La Pampa', 'La Rioja', 'Mendoza', 'Misiones', 'Neuquén', 'Río Negro', 'Salta', 'San Juan', 'San Luis', 'Santa Cruz', 'Santa Fe', 'Santiago del Estero', 'Tierra del Fuego', 'Tucumán'],
  'Australia': ['Australian Capital Territory', 'New South Wales', 'Northern Territory', 'Queensland', 'South Australia', 'Tasmania', 'Victoria', 'Western Australia'],
  'Austria': ['Burgenland', 'Carinthia', 'Lower Austria', 'Upper Austria', 'Salzburg', 'Styria', 'Tyrol', 'Vorarlberg', 'Vienna'],
  'Bangladesh': ['Barisal', 'Chittagong', 'Dhaka', 'Khulna', 'Mymensingh', 'Rajshahi', 'Rangpur', 'Sylhet'],
  'Belgium': ['Antwerp', 'Brussels', 'East Flanders', 'Flemish Brabant', 'Hainaut', 'Liège', 'Limburg', 'Luxembourg', 'Namur', 'Walloon Brabant', 'West Flanders'],
  'Brazil': ['Acre', 'Alagoas', 'Amapá', 'Amazonas', 'Bahia', 'Ceará', 'Distrito Federal', 'Espírito Santo', 'Goiás', 'Maranhão', 'Mato Grosso', 'Mato Grosso do Sul', 'Minas Gerais', 'Pará', 'Paraíba', 'Paraná', 'Pernambuco', 'Piauí', 'Rio de Janeiro', 'Rio Grande do Norte', 'Rio Grande do Sul', 'Rondônia', 'Roraima', 'Santa Catarina', 'São Paulo', 'Sergipe', 'Tocantins'],
  'Canada': ['Alberta', 'British Columbia', 'Manitoba', 'New Brunswick', 'Newfoundland and Labrador', 'Northwest Territories', 'Nova Scotia', 'Nunavut', 'Ontario', 'Prince Edward Island', 'Quebec', 'Saskatchewan', 'Yukon'],
  'China': ['Anhui', 'Beijing', 'Chongqing', 'Fujian', 'Gansu', 'Guangdong', 'Guangxi', 'Guizhou', 'Hainan', 'Hebei', 'Heilongjiang', 'Henan', 'Hong Kong', 'Hubei', 'Hunan', 'Inner Mongolia', 'Jiangsu', 'Jiangxi', 'Jilin', 'Liaoning', 'Macau', 'Ningxia', 'Qinghai', 'Shaanxi', 'Shandong', 'Shanghai', 'Shanxi', 'Sichuan', 'Tianjin', 'Tibet', 'Xinjiang', 'Yunnan', 'Zhejiang'],
  'Egypt': ['Alexandria', 'Aswan', 'Asyut', 'Beheira', 'Beni Suef', 'Cairo', 'Dakahlia', 'Damietta', 'Fayyum', 'Gharbia', 'Giza', 'Ismailia', 'Kafr el-Sheikh', 'Luxor', 'Matrouh', 'Minya', 'Monufia', 'New Valley', 'North Sinai', 'Port Said', 'Qalyubia', 'Qena', 'Red Sea', 'Sharqia', 'Sohag', 'South Sinai', 'Suez'],
  'France': ['Auvergne-Rhône-Alpes', 'Bourgogne-Franche-Comté', 'Brittany', 'Centre-Val de Loire', 'Corsica', 'Grand Est', 'Hauts-de-France', 'Île-de-France', 'Normandy', 'Nouvelle-Aquitaine', 'Occitanie', 'Pays de la Loire', 'Provence-Alpes-Côte dAzur'],
  'Germany': ['Baden-Württemberg', 'Bavaria', 'Berlin', 'Brandenburg', 'Bremen', 'Hamburg', 'Hesse', 'Lower Saxony', 'Mecklenburg-Vorpommern', 'North Rhine-Westphalia', 'Rhineland-Palatinate', 'Saarland', 'Saxony', 'Saxony-Anhalt', 'Schleswig-Holstein', 'Thuringia'],
  'Ghana': ['Ashanti', 'Brong-Ahafo', 'Central', 'Eastern', 'Greater Accra', 'Northern', 'Upper East', 'Upper West', 'Volta', 'Western'],
  'India': ['Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand', 'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur', 'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura', 'Uttar Pradesh', 'Uttarakhand', 'West Bengal', 'Andaman and Nicobar Islands', 'Chandigarh', 'Dadra and Nagar Haveli', 'Daman and Diu', 'Delhi', 'Lakshadweep', 'Puducherry'],
  'Indonesia': ['Aceh', 'Bali', 'Bangka Belitung', 'Banten', 'Bengkulu', 'Central Java', 'Central Kalimantan', 'Central Sulawesi', 'East Java', 'East Kalimantan', 'East Nusa Tenggara', 'Gorontalo', 'Jakarta', 'Jambi', 'Lampung', 'Maluku', 'North Kalimantan', 'North Maluku', 'North Sulawesi', 'North Sumatra', 'Papua', 'Riau', 'Riau Islands', 'South Kalimantan', 'South Sulawesi', 'South Sumatra', 'Southeast Sulawesi', 'West Java', 'West Kalimantan', 'West Nusa Tenggara', 'West Papua', 'West Sulawesi', 'West Sumatra', 'Yogyakarta'],
  'Italy': ['Abruzzo', 'Basilicata', 'Calabria', 'Campania', 'Emilia-Romagna', 'Friuli-Venezia Giulia', 'Lazio', 'Liguria', 'Lombardy', 'Marche', 'Molise', 'Piedmont', 'Puglia', 'Sardinia', 'Sicily', 'Trentino-Alto Adige', 'Tuscany', 'Umbria', 'Aosta Valley', 'Veneto'],
  'Japan': ['Aichi', 'Akita', 'Aomori', 'Chiba', 'Ehime', 'Fukui', 'Fukuoka', 'Fukushima', 'Gifu', 'Gunma', 'Hiroshima', 'Hokkaido', 'Hyogo', 'Ibaraki', 'Ishikawa', 'Iwate', 'Kagawa', 'Kagoshima', 'Kanagawa', 'Kochi', 'Kumamoto', 'Kyoto', 'Mie', 'Miyagi', 'Miyazaki', 'Nagano', 'Nagasaki', 'Nara', 'Niigata', 'Oita', 'Okayama', 'Okinawa', 'Osaka', 'Saga', 'Saitama', 'Shiga', 'Shimane', 'Shizuoka', 'Tochigi', 'Tokushima', 'Tokyo', 'Tottori', 'Toyama', 'Wakayama', 'Yamagata', 'Yamaguchi', 'Yamanashi'],
  'Kenya': ['Baringo', 'Bomet', 'Bungoma', 'Busia', 'Elgeyo-Marakwet', 'Embu', 'Garissa', 'Homa Bay', 'Isiolo', 'Kajiado', 'Kakamega', 'Kericho', 'Kiambu', 'Kilifi', 'Kirinyaga', 'Kisii', 'Kisumu', 'Kitui', 'Kwale', 'Laikipia', 'Lamu', 'Machakos', 'Makueni', 'Mandera', 'Marsabit', 'Meru', 'Migori', 'Mombasa', 'Murang\'a', 'Nairobi', 'Nakuru', 'Nandi', 'Narok', 'Nyamira', 'Nyandarua', 'Nyeri', 'Samburu', 'Siaya', 'Taita-Taveta', 'Tana River', 'Tharaka-Nithi', 'Trans Nzoia', 'Turkana', 'Uasin Gishu', 'Vihiga', 'Wajir', 'West Pokot'],
  'Mexico': ['Aguascalientes', 'Baja California', 'Baja California Sur', 'Campeche', 'Chiapas', 'Chihuahua', 'Coahuila', 'Colima', 'Durango', 'Guanajuato', 'Guerrero', 'Hidalgo', 'Jalisco', 'Mexico', 'Michoacán', 'Morelos', 'Nayarit', 'Nuevo León', 'Oaxaca', 'Puebla', 'Querétaro', 'Quintana Roo', 'San Luis Potosí', 'Sinaloa', 'Sonora', 'Tabasco', 'Tamaulipas', 'Tlaxcala', 'Veracruz', 'Yucatán', 'Zacatecas', 'Mexico City'],
  'Nigeria': ['Abia', 'Adamawa', 'Akwa Ibom', 'Anambra', 'Bauchi', 'Bayelsa', 'Benue', 'Borno', 'Cross River', 'Delta', 'Ebonyi', 'Edo', 'Ekiti', 'Enugu', 'FCT', 'Gombe', 'Imo', 'Jigawa', 'Kaduna', 'Kano', 'Katsina', 'Kebbi', 'Kogi', 'Kwara', 'Lagos', 'Nasarawa', 'Niger', 'Ogun', 'Ondo', 'Osun', 'Oyo', 'Plateau', 'Rivers', 'Sokoto', 'Taraba', 'Yobe', 'Zamfara'],
  'Pakistan': ['Balochistan', 'Khyber Pakhtunkhwa', 'Punjab', 'Sindh', 'Azad Kashmir', 'Gilgit-Baltistan', 'Islamabad Capital Territory'],
  'Philippines': ['Abra', 'Agusan del Norte', 'Agusan del Sur', 'Aklan', 'Albay', 'Antique', 'Apayao', 'Aurora', 'Basilan', 'Bataan', 'Batanes', 'Batangas', 'Benguet', 'Biliran', 'Bohol', 'Bukidnon', 'Bulacan', 'Cagayan', 'Camarines Norte', 'Camarines Sur', 'Camiguin', 'Capiz', 'Catanduanes', 'Cavite', 'Cebu', 'Compostela Valley', 'Cotabato', 'Davao del Norte', 'Davao del Sur', 'Davao Oriental', 'Dinagat Islands', 'Eastern Samar', 'Guimaras', 'Ifugao', 'Ilocos Norte', 'Ilocos Sur', 'Iloilo', 'Isabela', 'Kalinga', 'Laguna', 'Lanao del Norte', 'Lanao del Sur', 'La Union', 'Leyte', 'Maguindanao', 'Marinduque', 'Masbate', 'Mindoro Occidental', 'Mindoro Oriental', 'Misamis Occidental', 'Misamis Oriental', 'Mountain Province', 'Negros Occidental', 'Negros Oriental', 'Northern Samar', 'Nueva Ecija', 'Nueva Vizcaya', 'Palawan', 'Pampanga', 'Pangasinan', 'Quezon', 'Quirino', 'Rizal', 'Romblon', 'Samar', 'Sarangani', 'Siquijor', 'Sorsogon', 'South Cotabato', 'Southern Leyte', 'Sultan Kudarat', 'Sulu', 'Surigao del Norte', 'Surigao del Sur', 'Tarlac', 'Tawi-Tawi', 'Zambales', 'Zamboanga del Norte', 'Zamboanga del Sur', 'Zamboanga Sibugay'],
  'Russia': ['Adygea', 'Altai Krai', 'Altai Republic', 'Amur Oblast', 'Arkhangelsk Oblast', 'Astrakhan Oblast', 'Bashkortostan', 'Belgorod Oblast', 'Bryansk Oblast', 'Buryatia', 'Chelyabinsk Oblast', 'Chechnya', 'Chukotka', 'Chuvashia', 'Dagestan', 'Ingushetia', 'Irkutsk Oblast', 'Ivanovo Oblast', 'Jewish Autonomous Oblast', 'Kabardino-Balkaria', 'Kaliningrad Oblast', 'Kalmykia', 'Kaluga Oblast', 'Kamchatka Krai', 'Karachay-Cherkessia', 'Karelia', 'Kemerovo Oblast', 'Khabarovsk Krai', 'Khakassia', 'Khanty-Mansi', 'Kirov Oblast', 'Komi', 'Kostroma Oblast', 'Krasnodar Krai', 'Krasnoyarsk Krai', 'Kurgan Oblast', 'Kursk Oblast', 'Leningrad Oblast', 'Lipetsk Oblast', 'Magadan Oblast', 'Mari El', 'Mordovia', 'Moscow', 'Moscow Oblast', 'Murmansk Oblast', 'Nenets', 'Nizhny Novgorod Oblast', 'North Ossetia', 'Novgorod Oblast', 'Novosibirsk Oblast', 'Omsk Oblast', 'Orenburg Oblast', 'Oryol Oblast', 'Penza Oblast', 'Perm Krai', 'Primorsky Krai', 'Pskov Oblast', 'Rostov Oblast', 'Ryazan Oblast', 'Saint Petersburg', 'Sakha Republic', 'Sakhalin Oblast', 'Samara Oblast', 'Saratov Oblast', 'Smolensk Oblast', 'Stavropol Krai', 'Sverdlovsk Oblast', 'Tambov Oblast', 'Tatarstan', 'Tomsk Oblast', 'Tula Oblast', 'Tuva', 'Tver Oblast', 'Tyumen Oblast', 'Udmurtia', 'Ulyanovsk Oblast', 'Vladimir Oblast', 'Volgograd Oblast', 'Vologda Oblast', 'Voronezh Oblast', 'Yamalo-Nenets', 'Yaroslavl Oblast', 'Zabaykalsky Krai'],
  'South Africa': ['Eastern Cape', 'Free State', 'Gauteng', 'KwaZulu-Natal', 'Limpopo', 'Mpumalanga', 'Northern Cape', 'North West', 'Western Cape'],
  'Turkey': ['Adana', 'Adıyaman', 'Afyonkarahisar', 'Ağrı', 'Aksaray', 'Amasya', 'Ankara', 'Antalya', 'Ardahan', 'Artvin', 'Aydın', 'Balıkesir', 'Bartın', 'Batman', 'Bayburt', 'Bilecik', 'Bingöl', 'Bitlis', 'Bolu', 'Burdur', 'Bursa', 'Çanakkale', 'Çankırı', 'Çorum', 'Denizli', 'Diyarbakır', 'Düzce', 'Edirne', 'Elazığ', 'Erzincan', 'Erzurum', 'Eskişehir', 'Gaziantep', 'Giresun', 'Gümüşhane', 'Hakkâri', 'Hatay', 'Iğdır', 'Isparta', 'Istanbul', 'İzmir', 'Kahramanmaraş', 'Karabük', 'Karaman', 'Kars', 'Kastamonu', 'Kayseri', 'Kırıkkale', 'Kırklareli', 'Kırşehir', 'Kilis', 'Kocaeli', 'Konya', 'Kütahya', 'Malatya', 'Manisa', 'Mardin', 'Mersin', 'Muğla', 'Muş', 'Nevşehir', 'Niğde', 'Ordu', 'Osmaniye', 'Rize', 'Sakarya', 'Samsun', 'Siirt', 'Sinop', 'Sivas', 'Şanlıurfa', 'Şırnak', 'Tekirdağ', 'Tokat', 'Trabzon', 'Tunceli', 'Uşak', 'Van', 'Yalova', 'Yozgat', 'Zonguldak'],
  'United Kingdom': ['England', 'Scotland', 'Wales', 'Northern Ireland'],
  'United States': ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming']
};

function loadCountries() {
  const countrySelect = document.getElementById('country');
  const sortedCountries = Object.keys(countries).sort();
  
  countrySelect.innerHTML = '<option value="">Select Country</option>';
  sortedCountries.forEach(country => {
    const option = document.createElement('option');
    option.value = country;
    option.textContent = country;
    countrySelect.appendChild(option);
  });
}

function loadStates() {
  const countrySelect = document.getElementById('country');
  const stateSelect = document.getElementById('state');
  const selectedCountry = countrySelect.value;
  
  stateSelect.innerHTML = '<option value="">Select State</option>';
  
  if (selectedCountry && countries[selectedCountry]) {
    countries[selectedCountry].forEach(state => {
      const option = document.createElement('option');
      option.value = state;
      option.textContent = state;
      stateSelect.appendChild(option);
    });
  }
}

function toggleAuthMode() {
  isLoginMode = !isLoginMode;
  
  if (isLoginMode) {
    document.getElementById('authTitle').textContent = 'Welcome Back';
    document.getElementById('authSubtitle').textContent = 'Sign in to your account';
    document.getElementById('usernameGroup').style.display = 'none';
    document.getElementById('phoneGroup').style.display = 'none';
    document.getElementById('countryGroup').style.display = 'none';
    document.getElementById('stateGroup').style.display = 'none';
    document.getElementById('genderGroup').style.display = 'none';
    document.getElementById('verificationGroup').style.display = 'none';
    document.getElementById('confirmPasswordGroup').style.display = 'none';
    document.getElementById('authBtn').innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
    document.getElementById('switchText').textContent = "Don't have an account?";
    document.getElementById('switchLink').textContent = 'Sign up';
  } else {
    document.getElementById('authTitle').textContent = 'Create Account';
    document.getElementById('authSubtitle').textContent = 'Join Earnly and start earning';
    document.getElementById('usernameGroup').style.display = 'block';
    document.getElementById('phoneGroup').style.display = 'block';
    document.getElementById('countryGroup').style.display = 'block';
    document.getElementById('stateGroup').style.display = 'block';
    document.getElementById('genderGroup').style.display = 'block';
    document.getElementById('verificationGroup').style.display = 'block';
    document.getElementById('confirmPasswordGroup').style.display = 'block';
    document.getElementById('authBtn').innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
    document.getElementById('switchText').textContent = 'Already have an account?';
    document.getElementById('switchLink').textContent = 'Sign in';
    loadCountries();
  }
}

async function handleAuth(event) {
  event.preventDefault();
  
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  
  if (isLoginMode) {
    // Login
    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      
      const data = await response.json();
      
      if (data.status) {
        localStorage.setItem('earnly_token', data.token);
        localStorage.setItem('earnly_user', JSON.stringify(data.user));
        window.location.href = 'dashboard.html';
      } else {
        showMessage(data.msg, 'error');
      }
    } catch (error) {
      showMessage('Login failed. Please try again.', 'error');
    }
  } else {
    // Signup
    const username = document.getElementById('username').value;
    const phone = document.getElementById('phone').value;
    const country = document.getElementById('country').value;
    const state = document.getElementById('state').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const referralCode = localStorage.getItem('earnly_referral_code');
    
    if (password !== confirmPassword) {
      showMessage('Passwords do not match', 'error');
      return;
    }
    
    try {
      const endpoint = referralCode ? '/api/auth/signup-with-referral' : '/api/auth/signup';
      const body = { username, email, password, phone, country, state };
      if (referralCode) body.referralCode = referralCode;
      
      const response = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      
      const data = await response.json();
      
      if (data.status) {
        localStorage.setItem('earnly_token', data.token);
        localStorage.setItem('earnly_user', JSON.stringify(data.user));
        localStorage.removeItem('earnly_referral_code');
        window.location.href = 'dashboard.html';
      } else {
        showMessage(data.msg, 'error');
      }
    } catch (error) {
      showMessage('Signup failed. Please try again.', 'error');
    }
  }
}

function showMessage(text, type) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    border-radius: 12px;
    color: white;
    z-index: 1001;
    background: ${type === 'success' ? '#10b981' : '#ef4444'};
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
  `;
  notification.textContent = text;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    document.body.removeChild(notification);
  }, 3000);
}

function togglePassword(fieldId) {
  const field = document.getElementById(fieldId);
  const eye = document.getElementById(fieldId + 'Eye');
  
  if (field.type === 'password') {
    field.type = 'text';
    eye.className = 'fas fa-eye-slash';
  } else {
    field.type = 'password';
    eye.className = 'fas fa-eye';
  }
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  
  // Check for signup mode
  const mode = urlParams.get('mode');
  if (mode === 'signup' && isLoginMode) {
    toggleAuthMode();
  }
  
  // Check for referral code in URL
  const referralCode = urlParams.get('ref');
  if (referralCode) {
    localStorage.setItem('earnly_referral_code', referralCode);
    // Switch to signup mode
    if (isLoginMode) {
      toggleAuthMode();
    }
    showMessage('Referral code applied! Complete signup to earn bonus.', 'success');
  }
});

function detectNetwork() {
  const phone = document.getElementById('phone').value;
  // Auto-detect network based on phone number prefix
  // This is a simplified version - in production, use proper network detection
}

let currentCodeId = null;
let pendingSignupData = null;

async function sendVerificationCode(phone, email, method) {
  try {
    const response = await fetch('/api/send-verification', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phoneNumber: phone, email, method })
    });
    
    const data = await response.json();
    if (data.status) {
      currentCodeId = data.codeId;
      showMessage(`Verification code sent to your ${method}`, 'success');
      document.getElementById('verificationModal').style.display = 'flex';
      document.getElementById('verificationCode').focus();
      
      // For demo purposes, show the code in console
      console.log(`Demo: Your verification code is ${data.code}`);
    } else {
      throw new Error(data.msg);
    }
  } catch (error) {
    showMessage(error.message, 'error');
  }
}

function closeVerificationModal() {
  document.getElementById('verificationModal').style.display = 'none';
  document.getElementById('verificationCode').value = '';
  currentCodeId = null;
  pendingSignupData = null;
}

async function verifyCode() {
  if (!currentCodeId) {
    showMessage('No verification code session found', 'error');
    return;
  }
  
  const enteredCode = document.getElementById('verificationCode').value;
  if (enteredCode.length !== 4) {
    showMessage('Please enter a 4-digit code', 'error');
    return;
  }
  
  try {
    const response = await fetch('/api/verify-code', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ codeId: currentCodeId, code: enteredCode })
    });
    
    const data = await response.json();
    if (data.status) {
      // Complete signup after verification
      if (pendingSignupData) {
        await completeSignup();
      }
    } else {
      showMessage(data.msg, 'error');
    }
  } catch (error) {
    showMessage('Verification failed', 'error');
  }
}

async function completeSignup() {
  try {
    const response = await api.signup(pendingSignupData);
    showSuccessMessage();
  } catch (error) {
    showMessage(error.message, 'error');
    closeVerificationModal();
  }
}

function showSuccessMessage() {
  closeVerificationModal();
  
  const successModal = document.createElement('div');
  successModal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1001;
  `;
  
  successModal.innerHTML = `
    <div style="background: var(--dark-2); padding: 2rem; border-radius: 16px; text-align: center; max-width: 400px;">
      <div style="color: var(--secondary); font-size: 4rem; margin-bottom: 1rem;">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2 style="color: var(--secondary); margin-bottom: 1rem;">Welcome to Earnly!</h2>
      <p style="margin-bottom: 0.5rem;">Your account has been created successfully.</p>
      <p style="margin-bottom: 0.5rem;">Start earning money by completing tasks.</p>
      <p style="margin-bottom: 0.5rem;">Refer friends and get rewarded.</p>
      <p style="margin-bottom: 0.5rem;">Claim your daily bonus every day.</p>
      <p style="color: var(--accent);">Happy earning!</p>
    </div>
  `;
  
  document.body.appendChild(successModal);
  
  setTimeout(() => {
    document.body.removeChild(successModal);
    window.location.href = 'dashboard.html';
  }, 4000);
}

document.getElementById('authForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const btn = document.getElementById('authBtn');
  const originalText = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
  btn.disabled = true;
  
  try {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    
    if (isLoginMode) {
      const response = await api.login({ email, password });
      showMessage('Login successful!', 'success');
      setTimeout(() => {
        window.location.href = 'dashboard.html';
      }, 1000);
    } else {
      const username = document.getElementById('username').value;
      const phone = document.getElementById('phone').value;
      const country = document.getElementById('country').value;
      const state = document.getElementById('state').value;
      const gender = document.getElementById('gender').value;
      const verificationMethod = document.getElementById('verification').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (password !== confirmPassword) {
        throw new Error('Passwords do not match');
      }
      
      if (password.length < 6) {
        throw new Error('Password must be at least 6 characters');
      }
      
      if (!phone || !country || !state || !gender) {
        throw new Error('Please fill all required fields');
      }
      
      // Store signup data and send verification code
      pendingSignupData = { username, email, password, phone, country, state, gender };
      await sendVerificationCode(phone, email, verificationMethod);
      return;
    }
  } catch (error) {
    showMessage(error.message, 'error');
    btn.innerHTML = originalText;
    btn.disabled = false;
  }
});

function togglePassword(fieldId) {
  const passwordField = document.getElementById(fieldId);
  const eyeIcon = document.getElementById(fieldId + 'Eye');
  
  if (passwordField.type === 'password') {
    passwordField.type = 'text';
    eyeIcon.className = 'fas fa-eye-slash';
  } else {
    passwordField.type = 'password';
    eyeIcon.className = 'fas fa-eye';
  }
}

function showMessage(text, type = 'error') {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    border-radius: 12px;
    color: white;
    z-index: 1001;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    animation: slideIn 0.3s ease;
    background: ${type === 'success' ? 'var(--secondary)' : 'var(--danger)'};
  `;
  
  notification.innerHTML = `
    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
    <span>${text}</span>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    document.body.removeChild(notification);
  }, 3000);
}

// Check if already logged in
if (api.isAuthenticated()) {
  window.location.href = 'dashboard.html';
}
</script>
</body>
</html>